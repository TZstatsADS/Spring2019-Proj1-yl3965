---
title: "How Happy Moments Changes In Different Gender?"
author: "Yuqiao Li yl3965"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This report focuses on the happy moments of male and female, trying to figure out what makes different genders happy in their daily life. What¡¯ s more, I¡¯m interested in how the happy moments change as time goes by. Will there be a trend of reverse when people become older?

```{r load libraries, warning=FALSE, message=FALSE}
Sys.setlocale('LC_ALL','C')
library(tm)
library(wordcloud)
library(RColorBrewer)
library(dplyr)
library(tidytext)
library(tidyverse)
library(tidytext)
library(DT)
library(scales)
library(wordcloud2)
library(gridExtra)
library(ngram)
library(shiny) 
library(ggplot2)
```

```{r load data, warning=FALSE, message=FALSE}
setwd('C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/output')
hm_data <- read_csv("../output/processed_moments.csv")

urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read_csv(urlfile)
```

```{r combining data, warning=FALSE, message=FALSE}
hm_data <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         marital, 
         parenthood,
         reflection_period,
         age, 
         country, 
         ground_truth_category, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(marital %in% c("single", "married")) %>%
  filter(parenthood %in% c("n", "y")) %>%
  filter(reflection_period %in% c("24h", "3m")) %>%
  mutate(reflection_period = fct_recode(reflection_period, 
                                        months_3 = "3m", hours_24 = "24h"))
write_csv(hm_data, "C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/output/hm_data.csv")
```
```{r}
enterta_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/entertainment-dict.txt")
exer_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/exercise-dict.txt")
people_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/people-dict.txt")
food_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/food-dict.txt")
shop_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/shopping-dict.txt")
work_dict <- read.table("C:/Users/Administrator/Documents/GitHub/Spring2019-Proj1-yl3965/data/work-dict.txt")

```

#1.Predicted Category of Happy Moments
  
  First we try to observe the predicted category of Happy Moments.

```{r}
#hm's ground_truth_category (predicted_category) plot
pred_levels <- levels(factor(hm_data$ground_truth_category))
pred_info<-as.data.frame(matrix(rep(0,2*length(pred_levels)),ncol=2))
for(i in 1:length(pred_levels)){
  pred_info[i,1]=pred_levels[i]
  pred_info[i,2]=as.numeric(sum(hm_data$ground_truth_category==pred_levels[i],na.rm = T))
}
colnames(pred_info)<-c("cate","val")
pred_info$cate = factor(pred_info$cate, levels=pred_info[order(pred_info$val),1])

ggplot(pred_info, aes(x=cate,y=val)) + labs(x = "Predicted_Category", y = "Count")+ geom_bar(stat = "identity")+coord_flip()
```
  
  As we can see from the plot above, "affection" and "achievement" give most of the happy moments people have, while "exercise" gives the least amount of joy. Also the bonding part may have some cross with affection. So from the predicted category, we conclude that most of the happy moments of people are connection between others. The second is the achievement partt part: success and finish. We use text part below for more accurate analysis.

  This is a word cloud of whole data.
```{r}
hm_text_one <- paste(hm_data$text,collapse=" ")
hm_text_split <- strsplit(hm_text_one, split=" ")[[1]]

word_count <- table(hm_text_split)
word_count <- sort(word_count, decreasing = TRUE)
wordcloud2(word_count[1:100],minRotation = 0, maxRotation = 0,shape = 'circle')
```
  
  From the picture, main topics of happy moments are in friend, family, food, entertainment.
  
#2. What is the difference between male and male?
  
  Most Common Happy Moments of Female:
```{r}
female<-hm_data[hm_data$gender=="f",] 
female_text_one <- paste(female$text,collapse=" ")
female_text_split <- strsplit(female_text_one, split=" ")[[1]]

female_count <- table(female_text_split)
female_count <- sort(female_count, decreasing = TRUE)
wordcloud2(female_count[1:100],minRotation = 0, maxRotation = 0,shape='circle')

```
  
  From the word cloud for female, we can see the most popular words are something concerning people and family, espectially family members, like daughter, son, husband.
    
  Most Common Happy Moments of Male:
```{r}
male<-hm_data[hm_data$gender=="m",]
male_text_one <- paste(male$text,collapse=" ")
male_text_split <- strsplit(male_text_one, split=" ")[[1]]

male_count <- table(male_text_split)
male_count <- sort(male_count, decreasing = TRUE)
wordcloud2(male_count[1:50],minRotation = 0, maxRotation = 0)

```
  
  From From the word cloud for male, we can see the most popular words are something concerning people and entertainment. Unlike the female word cloud, it mentions words like "played", "won" and "game".
  
#How do the proportions of six selected topics change between female and male?

  First we use several dictionaries to categorize the topic: "entertainment", "exercise", "people", "food", "shopping", "work".
```{r}
#proportions of six topics change between female 
#female;entertainment
setwd('C:/Users/Administrator/Desktop')

enterta_dict <- paste(enterta_dict$V1,collapse="|")
enterta_dict <- strsplit(enterta_dict, split=" ")[[1]]
female_enterta<-grep(enterta_dict,female$text)#number of female;entertainment in female$text


#female;exercise
exer_dict <- paste(exer_dict$V1,collapse="|")
exer_dict <- strsplit(exer_dict, split=" ")[[1]]
female_exer<-grep(exer_dict,female$text)

#female;people
people_dict <- paste(people_dict$V1,collapse="|")
people_dict <- strsplit(people_dict, split=" ")[[1]]
female_people<-grep(people_dict,female$text)

#female;food
food_dict <- paste(food_dict$V1,collapse="|")
food_dict <- strsplit(food_dict, split=" ")[[1]]
female_food<-grep(food_dict,female$text)


#female;shopping
shop_dict <- paste(shop_dict$V1,collapse="|")
shop_dict <- strsplit(shop_dict, split=" ")[[1]]
female_shop<-grep(shop_dict,female$text)


#female;work
work_dict <- paste(work_dict$V1,collapse="|")
work_dict <- strsplit(work_dict, split=" ")[[1]]
female_work<-grep(work_dict,female$text)

topic<-c("entertainment", "exercise", "people", "food", "shopping", "work")
topic_levels <- levels(factor(topic))
female_tot<-length(female_enterta)+length(female_exer)+length(female_people)+length(female_food)+length(female_shop)+length(female_work)
female_prop <- as.data.frame(matrix(rep(0,12),ncol=2))

female_prop[,1]=topic_levels
female_prop[1,2]=length(female_enterta)/female_tot
female_prop[2,2]=length(female_exer)/female_tot
female_prop[3,2]=length(female_people)/female_tot
female_prop[4,2]=length(female_food)/female_tot
female_prop[5,2]=length(female_shop)/female_tot
female_prop[6,2]=length(female_work)/female_tot

colnames(female_prop)<-c("topic","prop")
female_prop$topic = factor(female_prop$topic, levels=female_prop[order(female_prop$prop),1])

```

```{r}
#proportions of six topics change between male 

male_enterta<-grep(enterta_dict,male$text)#number of male;entertainment in female$text
male_exer<-grep(exer_dict,male$text)
male_people<-grep(people_dict,male$text)
male_food<-grep(food_dict,male$text)
male_shop<-grep(shop_dict,male$text)
male_work<-grep(work_dict,male$text)


male_tot<-length(male_enterta)+length(male_exer)+length(male_people)+length(male_food)+length(male_shop)+length(male_work)
male_prop <- as.data.frame(matrix(rep(0,12),ncol=2))

male_prop[,1]=topic_levels
male_prop[1,2]=length(male_enterta)/male_tot
male_prop[2,2]=length(male_exer)/male_tot
male_prop[3,2]=length(male_people)/male_tot
male_prop[4,2]=length(male_food)/male_tot
male_prop[5,2]=length(male_shop)/male_tot
male_prop[6,2]=length(male_work)/male_tot

colnames(male_prop)<-c("topic","prop")
male_prop$topic = factor(male_prop$topic, levels=male_prop[order(male_prop$prop),1])
```

```{r}
female_prop[,"gender"]="female"
male_prop[,"gender"]="male"
total_prop<-rbind(female_prop,male_prop)

ggplot(total_prop,aes(topic,prop,fill=gender))+geom_bar(stat = "identity",position="dodge")
```
  
  It is surprising that ¡°food¡± has the largest proportion among the six topics. The first time I saw the word cloud above, I thought that ¡°people¡± may be the most popular one. Because here are many words from people-dictionary in the word cloud like friend, family, son, etc. But finally the result comes out ¡°food¡± both in female and male. And the value of proportion is twice higher than the second one. What¡¯s more, the proportion of different topic looks approximately the same between man and woman. 
  
  
  In order to figure out the difference between man and woman, next I try to find out the influence of every topic on happy moments will change over time between different genders. So I calculate the proportion of topics in three age intervals: ¡°less than 30¡±, ¡°30 to 60¡± and ¡°larger than 60¡±.
  
#4. Does influence of topic change over time between different genders?
  
```{r}
age_table<-as.data.frame(matrix(rep(0,36*4),ncol=4))
colnames(age_table)<-c("topic","gender","age","prop")
age_table$topic<-rep(c("entertainment", "exercise", "people", "food", "shopping", "work"),6)
age_table$gender<-c(rep("f",18),rep("m",18))
age_table$age<-c(rep("30-",6),rep("30-60",6),rep("60+",6),rep("30-",6),rep("30-60",6),rep("60+",6))


age_table[1,"prop"]<-length(grep(enterta_dict,female[female$age<30,]$text))
age_table[2,"prop"]<-length(grep(exer_dict,female[female$age<30,]$text))
age_table[3,"prop"]<-length(grep(people_dict,female[female$age<30,]$text))
age_table[4,"prop"]<-length(grep(food_dict,female[female$age<30,]$text))
age_table[5,"prop"]<-length(grep(shop_dict,female[female$age<30,]$text))
age_table[6,"prop"]<-length(grep(work_dict,female[female$age<30,]$text))


  
age_table[7,"prop"]<-length(grep(enterta_dict,female[female$age>=30 &female$age<60,]$text))
age_table[8,"prop"]<-length(grep(exer_dict,female[female$age>=30 &female$age<60,]$text))
age_table[9,"prop"]<-length(grep(people_dict,female[female$age>=30 &female$age<60,]$text))
age_table[10,"prop"]<-length(grep(food_dict,female[female$age>=30 &female$age<60,]$text))
age_table[11,"prop"]<-length(grep(shop_dict,female[female$age>=30 &female$age<60,]$text))
age_table[12,"prop"]<-length(grep(work_dict,female[female$age>=30 &female$age<60,]$text))

  
age_table[13,"prop"]<-length(grep(enterta_dict,female[female$age>=60,]$text))
age_table[14,"prop"]<-length(grep(exer_dict,female[female$age>=60,]$text))
age_table[15,"prop"]<-length(grep(people_dict,female[female$age>=60,]$text))
age_table[16,"prop"]<-length(grep(food_dict,female[female$age>=60,]$text))
age_table[17,"prop"]<-length(grep(shop_dict,female[female$age>=60,]$text))
age_table[18,"prop"]<-length(grep(work_dict,female[female$age>=60,]$text))
  

age_table[19,"prop"]<-length(grep(enterta_dict,male[male$age<30,]$text))
age_table[20,"prop"]<-length(grep(exer_dict,male[male$age<30,]$text))
age_table[21,"prop"]<-length(grep(people_dict,male[male$age<30,]$text))
age_table[22,"prop"]<-length(grep(food_dict,male[male$age<30,]$text))
age_table[23,"prop"]<-length(grep(shop_dict,male[male$age<30,]$text))
age_table[24,"prop"]<-length(grep(work_dict,male[male$age<30,]$text))


  
age_table[25,"prop"]<-length(grep(enterta_dict,male[male$age>=30 &male$age<60,]$text))
age_table[26,"prop"]<-length(grep(exer_dict,male[male$age>=30 &male$age<60,]$text))
age_table[27,"prop"]<-length(grep(people_dict,male[male$age>=30 &male$age<60,]$text))
age_table[28,"prop"]<-length(grep(food_dict,male[male$age>=30 &male$age<60,]$text))
age_table[29,"prop"]<-length(grep(shop_dict,male[male$age>=30 &male$age<60,]$text))
age_table[30,"prop"]<-length(grep(work_dict,male[male$age>=30 &male$age<60,]$text))

  
age_table[31,"prop"]<-length(grep(enterta_dict,male[male$age>=60,]$text))
age_table[32,"prop"]<-length(grep(exer_dict,male[male$age>=60,]$text))
age_table[33,"prop"]<-length(grep(people_dict,male[male$age>=60,]$text))
age_table[34,"prop"]<-length(grep(food_dict,male[male$age>=60,]$text))
age_table[35,"prop"]<-length(grep(shop_dict,male[male$age>=60,]$text))
age_table[36,"prop"]<-length(grep(work_dict,male[male$age>=60,]$text))
  
for(j in 0:5)
  for(i in c(1:6)+6*j)   
    age_table[i,"total"]=sum(age_table[c(1:6)+6*j,"prop"])

age_table[,"prop"]=age_table[,"prop"]/age_table[,"total"]

```


```{r}
#change of entertainment
enterta<-age_table[age_table$topic=="entertainment",]
ggplot(enterta,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("entertainment")
```
  
  In total, Male has a higher proportion of entertainment than Female. The value of female¡¯s is increasing as time goes by, but the value of man¡¯s has a slight descent in the age 30-60 and then increase a little. 

```{r}
#change of exercise
exercise<-age_table[age_table$topic=="exercise",]
ggplot(exercise,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("exercise")
```
  
  For this plot, it seems male are more interesting in exercise than female at the beginning. But as they become older, the proportion converges to the same level.
  
```{r}
#change of people
people<-age_table[age_table$topic=="people",]
ggplot(people,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("people")
```
  
  For people topic, female accounts relationship more than male when they are young, but less when they are older. Maybe it is because female invest to much energy in affection before and want more private time and space when they are older.
  
```{r}
#change of food
food<-age_table[age_table$topic=="food",]
ggplot(food,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("food")
```
  
  Female¡¯s interest in food keeps in a same level. Fore man, They have a higher enthusiasm for food before 60. They might spend more time in exercising instead of enjoying food when they are around 60.
  
```{r}
#change of shopping
shopping<-age_table[age_table$topic=="shopping",]
ggplot(shopping,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("shopping")
```
  
  The proportion of shopping in female drops sharply between age 30-60 but keeps the same level before 30 and after 60. Male has a slightly drop after 30.
  
```{r}
#change of work
work<-age_table[age_table$topic=="work",]
ggplot(work,aes(x=age,y=prop,color=gender,group=gender))+geom_line(size=2)+ggtitle("work")
```
  
  People seems to have a lower interest in work as they become older. Also regarding to retirement, it is reasonable to see the low rate of work after 60.
  
#Conclusion
  
  From the plot and analysis above, we can concluded that man and woman act similarly in some topics like exercise, work, shopping. This is also consistent with our common sense. However, different genders also have some types of happy moments which are totally far away from each other.
   
  For female, they attach more importance on relationship and affection, especially when the are young. But when they grow older, the connection with people seems to be weakened. What¡¯ s more, the food topic keeps at the same level in three age intervals.
  
  For male, the importance of relationship grows and the interest in food decreases quickly when older. Also, they have less happy time in entertainment comparing to woman. And for the food topic, it increases a little but drop finally to a much lower level compared to woman.